import React, { useState, useEffect } from 'react';
import { Gift, Eye, EyeOff, Check, Snowflake, PartyPopper, Users, Lock, LogIn, Sparkles } from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot, updateDoc, arrayUnion } from 'firebase/firestore';

// --- KONFIGURACJA FIREBASE ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

// --- STYLE ---
const customStyles = `
@keyframes snowfall {
ยย0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
ยย100% { transform: translateY(100vh) rotate(360deg); opacity: 0.3; }
}
.snowflake {
ยยposition: absolute;
ยยtop: -10px;
ยยcolor: white;
ยยopacity: 0.6;
ยยpointer-events: none;
ยยz-index: 0;
ยยanimation: snowfall linear infinite;
}
.bg-glamour-pattern {
ยยยยbackground-color: #4a0404;
ยยยยbackground-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
`;

const Snowfall = () => {
ยยconst flakes = Array.from({ length: 20 });
ยยreturn (
ยยยย<div className="fixed inset-0 pointer-events-none overflow-hidden font-sans">
ยยยยยย<style>{customStyles}</style>
ยยยยยย{flakes.map((_, i) => (
ยยยยยยยย<div
ยยยยยยยยยยkey={i}
ยยยยยยยยยยclassName="snowflake text-white/30"
ยยยยยยยยยยstyle={{
ยยยยยยยยยยยยleft: `${Math.random() * 100}%`,
ยยยยยยยยยยยยfontSize: `${Math.random() * 20 + 10}px`,
ยยยยยยยยยยยยanimationDuration: `${Math.random() * 5 + 5}s`,
ยยยยยยยยยยยยanimationDelay: `${Math.random() * 5}s`,
ยยยยยยยยยย}}
ยยยยยยยย>
ยยยยยยยยยยโ
ยยยยยยยย</div>
ยยยยยย))}
ยยยย</div>
ยย);
};

// Funkcja sprawdzajฤca proste PINy
const isPinTooSimple = (pin) => {
ยยยยif (!pin || pin.length !== 4) return false;
ยยยย// 1. Jednakowe cyfry (np. 0000, 8888)
ยยยยif (/^(\d)\1{3}$/.test(pin)) return true;
ยยยย// 2. Proste sekwencje rosnฤce i malejฤce
ยยยยconst sequences = ['0123', '1234', '2345', '3456', '4567', '5678', '6789', '9876', '8765', '7654', '6543', '5432', '4321', '3210'];
ยยยยif (sequences.includes(pin)) return true;

ยยยยreturn false;
};

export default function ChristmasDraw() {
ยยconst [user, setUser] = useState(null);
ยยconst [roomName, setRoomName] = useState('');
ยยconst [roomData, setRoomData] = useState(null);
ยยconst [error, setError] = useState('');
ยย
ยย// Stany interfejsu
ยยconst [view, setView] = useState('login'); // login, lobby, pin-setup, reveal
ยยconst [selectedPerson, setSelectedPerson] = useState(null);
ยยconst [pinInput, setPinInput] = useState('');
ยยconst [isLoading, setIsLoading] = useState(false);

ยย// Staลe dane
ยยconst participantsList = ['Jacek', 'Pala', 'Filip', 'Danuta', 'Basia', 'Dawid'];
ยยconst budgetPool = [50, 150, 250, 500, 750, 1000];

ยย// 1. Autentykacja
ยยuseEffect(() => {
ยยยยconst initAuth = async () => {
ยยยยยยtry {
ยยยยยยยยif (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
ยยยยยยยยยยยawait signInAnonymously(auth);
ยยยยยยยย} else {
ยยยยยยยยยยawait signInAnonymously(auth);
ยยยยยยยย}
ยยยยยย} catch (e) {
ยยยยยยยยconsole.error("Auth error", e);
ยยยยยย}
ยยยย};
ยยยยinitAuth();
ยยยยconst unsubscribe = onAuthStateChanged(auth, setUser);
ยยยยreturn () => unsubscribe();
ยย}, []);

ยย// 2. Nasลuchiwanie pokoju (gdy uลผytkownik wpisze nazwฤ)
ยยuseEffect(() => {
ยยยยif (!user || !roomName) return;

ยยยย// PATH: artifacts/{appId}/public/data/draw_rooms/{roomName}
ยยยยconst roomDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'draw_rooms', roomName.toLowerCase());

ยยยยconst unsubscribe = onSnapshot(roomDocRef, (snapshot) => {
ยยยยยยif (snapshot.exists()) {
ยยยยยยยยsetRoomData(snapshot.data());
ยยยยยยยยif (view === 'login') setView('lobby');
ยยยยยย} else {
ยยยยยยยยif (view !== 'login' && view !== 'create') {
ยยยยยยยยยยย// Opcjonalnie obsลuga usuniฤcia pokoju
ยยยยยยยย}
ยยยยยย}
ยยยย}, (err) => {
ยยยยยยconsole.error("Bลฤd pobierania pokoju:", err);
ยยยยยยsetError("Nie moลผna poลฤczyฤ siฤ z pokojem.");
ยยยย});

ยยยยreturn () => unsubscribe();
ยย}, [user, roomName]);

ยย// --- LOGIKA ---

ยยconst handleJoinRoom = () => {
ยยยยif (!roomName.trim()) return;
ยยยยsetIsLoading(true);
ยยยยsetTimeout(() => {
ยยยยยยยยsetIsLoading(false);
ยยยยยยยยif (!roomData) {
ยยยยยยยยยยยยif (confirm(`๐ Ho Ho Ho! Pokรณj "${roomName}" nie istnieje. Czy chcesz go stworzyฤ i rozlosowaฤ prezenty?`)) {
ยยยยยยยยยยยยยยยยcreateRoom();
ยยยยยยยยยยยย}
ยยยยยยยย}
ยยยย}, 1500);
ยย};

ยยconst createRoom = async () => {
ยยยยtry {
ยยยยยยsetIsLoading(true);
ยยยยยย
ยยยยยย// Algorytm losowania
ยยยยยยlet validDraw = false;
ยยยยยยlet finalPairs = {};

ยยยยยยwhile (!validDraw) {
ยยยยยยยยlet receivers = [...participantsList];
ยยยยยยยยfor (let i = receivers.length - 1; i > 0; i--) {
ยยยยยยยยยยยยconst j = Math.floor(Math.random() * (i + 1));
ยยยยยยยยยยยย[receivers[i], receivers[j]] = [receivers[j], receivers[i]];
ยยยยยยยย}

ยยยยยยยยlet budgets = [...budgetPool];
ยยยยยยยยfor (let i = budgets.length - 1; i > 0; i--) {
ยยยยยยยยยยยยconst j = Math.floor(Math.random() * (i + 1));
ยยยยยยยยยยยย[budgets[i], budgets[j]] = [budgets[j], budgets[i]];
ยยยยยยยย}

ยยยยยยยยlet isSelfDraw = false;
ยยยยยยยยlet pairsObj = {};

ยยยยยยยยfor (let i = 0; i < participantsList.length; i++) {
ยยยยยยยยยยยยif (participantsList[i] === receivers[i]) {
ยยยยยยยยยยยยยยยยisSelfDraw = true;
ยยยยยยยยยยยยยยยยbreak;
ยยยยยยยยยยยย}
ยยยยยยยยยยยยpairsObj[participantsList[i]] = {
ยยยยยยยยยยยยยยยยreceiver: receivers[i],
ยยยยยยยยยยยยยยยยamount: budgets[i],
ยยยยยยยยยยยยยยยยpin: null,
ยยยยยยยยยยยยยยยยrevealed: false
ยยยยยยยยยยยย};
ยยยยยยยย}

ยยยยยยยยif (!isSelfDraw) {
ยยยยยยยยยยยยfinalPairs = pairsObj;
ยยยยยยยยยยยยvalidDraw = true;
ยยยยยยยย}
ยยยยยย}

ยยยยยยconst roomDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'draw_rooms', roomName.toLowerCase());
ยยยยยยawait setDoc(roomDocRef, {
ยยยยยยยยcreatedAt: new Date().toISOString(),
ยยยยยยยยassignments: finalPairs
ยยยยยย});
ยยยยยย
ยยยยยยsetView('lobby');
ยยยย} catch (e) {
ยยยยยยconsole.error(e);
ยยยยยยsetError("Bลฤd tworzenia pokoju.");
ยยยย} finally {
ยยยยยยsetIsLoading(false);
ยยยย}
ยย};

ยยconst handlePersonClick = (person) => {
ยยยยsetSelectedPerson(person);
ยยยยsetPinInput('');
ยยยยsetError('');
ยยยย
ยยยยconst personData = roomData.assignments[person];
ยยยยif (personData.pin) {
ยยยยยยsetView('pin-check');
ยยยย} else {
ยยยยยยsetView('pin-setup');
ยยยย}
ยย};

ยยconst handleSetupPin = async () => {
ยยยยif (pinInput.length < 4) {
ยยยยยยsetError("PIN musi mieฤ 4 cyfry.");
ยยยยยยreturn;
ยยยย}

ยยยย// NOWE ZABEZPIECZENIE PRZED PROSTYMI PINAMI
ยยยยif (isPinTooSimple(pinInput)) {
ยยยยยยยยsetError("๐ Mikoลaj prosi o trudniejszy kod! Unikaj ciฤgรณw typu 1234, 0000, 4321.");
ยยยยยยยยreturn;
ยยยย}
ยยยย
ยยยยtry {
ยยยยยยsetIsLoading(true);
ยยยยยยconst roomDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'draw_rooms', roomName.toLowerCase());
ยยยยยย
ยยยยยยawait updateDoc(roomDocRef, {
ยยยยยยยย[`assignments.${selectedPerson}.pin`]: pinInput
ยยยยยย});
ยยยยยย
ยยยยยยsetView('reveal');
ยยยย} catch (e) {
ยยยยยยsetError("Bลฤd zapisu PINu.");
ยยยย} finally {
ยยยยยยsetIsLoading(false);
ยยยย}
ยย};

ยยconst handleCheckPin = () => {
ยยยยconst correctPin = roomData.assignments[selectedPerson].pin;
ยยยยif (pinInput === correctPin) {
ยยยยยยsetView('reveal');
ยยยย} else {
ยยยยยยsetError("Bลฤdny PIN! Sprรณbuj jeszcze raz.");
ยยยย}
ยย};

ยยconst handleMarkAsRevealed = async () => {
ยยยยconst roomDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'draw_rooms', roomName.toLowerCase());
ยยยยawait updateDoc(roomDocRef, {
ยยยยยยยย[`assignments.${selectedPerson}.revealed`]: true
ยยยย});
ยยยยsetView('lobby');
ยยยยsetSelectedPerson(null);
ยย};

ยย// --- RENDEROWANIE ---

ยย// Common wrapper for glamour style
ยยconst GlamourWrapper = ({ children }) => (
ยยยย<div className="min-h-screen bg-glamour-pattern flex items-center justify-center p-4 font-sans text-slate-900 relative overflow-hidden">
ยยยยยย<div className="absolute inset-0 bg-gradient-to-b from-transparent via-black/20 to-black/50 pointer-events-none"></div>
ยยยยยย<Snowfall />
ยยยยยย<div className="bg-cream-100/95 backdrop-blur-md w-full max-w-md rounded-[2rem] shadow-[0_0_40px_rgba(212,175,55,0.3)] border-4 border-yellow-500/50 p-8 relative z-10 text-center overflow-hidden">
ยยยยยยยย<div className="absolute -top-10 -left-10 text-yellow-500/20 w-32 h-32"><Sparkles className="w-full h-full" /></div>
ยยยยยยยย<div className="absolute -bottom-10 -right-10 text-yellow-500/20 w-32 h-32"><Gift className="w-full h-full" /></div>
ยยยยยยยย{children}
ยยยยยย</div>
ยยยย</div>
ยย);

ยย// 1. EKRAN LOGOWANIA DO POKOJU
ยยif (view === 'login') {
ยยยยreturn (
ยยยยยย<GlamourWrapper>
ยยยยยยยยยย<div className="text-5xl mb-2">๐๐๐</div>
ยยยยยยยยยย<h1 className="text-4xl font-extrabold text-red-900 mb-2 drop-shadow-sm" style={{ fontFamily: 'Georgia, serif' }}>
ยยยยยยยยยยยยลwiฤteczne Losowanie
ยยยยยยยยยย</h1>
ยยยยยยยยยย<p className="text-red-800 font-bold mb-1 uppercase tracking-widest text-sm px-4">
ยยยยยยยยยยยยPowtรณrka losowania, bo Papcio jest oszustem
ยยยยยยยยยย</p>
ยยยยยยยยยย<p className="text-yellow-700 font-semibold mb-8 text-xs italic">
ยยยยยยยยยยยย(Wersja nie do zลamania przez Papcia ๐ต๏ธโโ๏ธ)
ยยยยยยยยยย</p>
ยยยยยยยยยย
ยยยยยยยยยย<div className="space-y-6 relative z-20">
ยยยยยยยยยยยย<div>
ยยยยยยยยยยยยยย<label className="block text-left text-sm font-bold text-red-900 mb-2 ml-1">Wpisz Nazwฤ Pokoju</label>
ยยยยยยยยยยยยยย<input 
ยยยยยยยยยยยยยยยยtype="text" 
ยยยยยยยยยยยยยยยยvalue={roomName}
ยยยยยยยยยยยยยยยยonChange={(e) => setRoomName(e.target.value.toUpperCase())}
ยยยยยยยยยยยยยยยยplaceholder="np. WIGILIA24"
ยยยยยยยยยยยยยยยยclassName="w-full p-4 border-2 border-yellow-400/50 bg-yellow-50/50 rounded-xl text-center text-2xl tracking-[0.2em] uppercase focus:border-yellow-600 focus:bg-white focus:outline-none text-red-900 font-bold placeholder:text-red-900/30 transition-all"
ยยยยยยยยยยยยยย/>
ยยยยยยยยยยยย</div>
ยยยยยยยยยยยย
ยยยยยยยยยยยย<button 
ยยยยยยยยยยยยยยonClick={handleJoinRoom}
ยยยยยยยยยยยยยยdisabled={isLoading || !roomName}
ยยยยยยยยยยยยยยclassName="w-full bg-gradient-to-r from-red-700 to-red-900 hover:from-red-800 hover:to-red-950 text-yellow-100 font-bold py-4 px-6 rounded-xl shadow-lg flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed border border-yellow-500/50"
ยยยยยยยยยยยย>
ยยยยยยยยยยยยยย{isLoading ? 'ลฤczฤ z Mikoลajem...' : (
ยยยยยยยยยยยยยยยย<>
ยยยยยยยยยยยยยยยยยย<LogIn className="w-6 h-6" />
ยยยยยยยยยยยยยยยยยย<span className="text-lg">Wejdลบ do Gry</span>
ยยยยยยยยยยยยยยยย</>
ยยยยยยยยยยยยยย)}
ยยยยยยยยยยยย</button>
ยยยยยยยยยยยย<p className="text-xs text-red-800/70 font-medium">Podaj tฤ samฤ nazwฤ co reszta rodziny!</p>
ยยยยยยยยยย</div>
ยยยยยย</GlamourWrapper>
ยยยย);
ยย}

ยย// 2. LOBBY (LISTA OSรB)
ยยif (view === 'lobby' && roomData) {
ยยยยconst myAssignment = roomData.assignments;
ยยยยconst allRevealed = Object.values(myAssignment).every(a => a.revealed);

ยยยยreturn (
ยยยยยย<GlamourWrapper>
ยยยยยยยยยย<div className="flex justify-between items-center mb-8 border-b-2 border-yellow-500/30 pb-4">
ยยยยยยยยยยยย<div className="text-left">
ยยยยยยยยยยยยยยยย<h2 className="text-xl font-bold text-red-900 flex items-center gap-2"><Gift className="text-yellow-600"/> Pokรณj: {roomName}</h2>
ยยยยยยยยยยยย</div>
ยยยยยยยยยยยย<button onClick={() => {setRoomName(''); setRoomData(null); setView('login')}} className="text-xs text-red-800 hover:text-red-600 font-semibold underline">Wyjลcie</button>
ยยยยยยยยยย</div>

ยยยยยยยยยย<h3 className="text-center text-2xl font-bold text-red-900 mb-6" style={{ fontFamily: 'Georgia, serif' }}>Kto teraz losuje? ๐</h3>
ยยยยยยยยยย
ยยยยยยยยยย<div className="grid grid-cols-2 gap-4 mb-8 relative z-20">
ยยยยยยยยยยยย{Object.keys(myAssignment).map(name => {
ยยยยยยยยยยยยยยconst personData = myAssignment[name];
ยยยยยยยยยยยยยยconst isSetup = !!personData.pin;
ยยยยยยยยยยยยยยconst isRevealed = personData.revealed;

ยยยยยยยยยยยยยยreturn (
ยยยยยยยยยยยยยยยย<button
ยยยยยยยยยยยยยยยยยยkey={name}
ยยยยยยยยยยยยยยยยยยonClick={() => handlePersonClick(name)}
ยยยยยยยยยยยยยยยยยยclassName={`
ยยยยยยยยยยยยยยยยยยยยpy-5 px-3 rounded-2xl font-bold text-base transition-all duration-300 relative group overflow-hidden
ยยยยยยยยยยยยยยยยยยยย${isRevealed 
ยยยยยยยยยยยยยยยยยยยยยย? 'bg-gray-100 text-gray-400 border-2 border-gray-200 grayscale' 
ยยยยยยยยยยยยยยยยยยยยยย: 'bg-gradient-to-br from-yellow-50 to-white border-2 border-yellow-400 text-red-900 shadow-md hover:border-red-600 hover:shadow-yellow-500/20 hover:-translate-y-1'
ยยยยยยยยยยยยยยยยยยยย}
ยยยยยยยยยยยยยยยยยย`}
ยยยยยยยยยยยยยยยย>
ยยยยยยยยยยยยยยยยยย<div className="flex flex-col items-center gap-1 relative z-10">
ยยยยยยยยยยยยยยยยยยยย<span className="text-lg">{name}</span>
ยยยยยยยยยยยยยยยยยยยย{isSetup ? (
ยยยยยยยยยยยยยยยยยยยยยยยย<span className={`text-[10px] px-2 py-0.5 rounded-full flex items-center gap-1 font-medium ${isRevealed ? 'bg-gray-200 text-gray-500' : 'bg-green-100 text-green-800'}`}>
ยยยยยยยยยยยยยยยยยยยยยยยยยยยย<Lock className="w-3 h-3" /> {isRevealed ? 'Odkryte' : 'Gotowe'}
ยยยยยยยยยยยยยยยยยยยยยยยย</span>
ยยยยยยยยยยยยยยยยยยยย) : (
ยยยยยยยยยยยยยยยยยยยยยยยย<span className="text-[10px] bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-medium flex items-center gap-1 animate-pulse">
ยยยยยยยยยยยยยยยยยยยยยยยยยยยย<Sparkles className="w-3 h-3" /> Ustaw PIN
ยยยยยยยยยยยยยยยยยยยยยยยย</span>
ยยยยยยยยยยยยยยยยยยยย)}
ยยยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยยยยยยยย{!isRevealed && <div className="absolute inset-0 bg-yellow-200 opacity-0 group-hover:opacity-10 transition-opacity"></div>}
ยยยยยยยยยยยยยยยย</button>
ยยยยยยยยยยยยยย);
ยยยยยยยยยยยย})}
ยยยยยยยยยย</div>

ยยยยยยยยยยยย{allRevealed && (
ยยยยยยยยยยยยยยยย<div className="bg-gradient-to-r from-green-100 to-green-200 border-2 border-green-400 rounded-xl p-6 text-center animate-in zoom-in shadow-lg relative z-20">
ยยยยยยยยยยยยยยยยยยยย<div className="text-4xl mb-2">๐๐</div>
ยยยยยยยยยยยยยยยยยยยย<p className="text-green-900 font-extrabold text-lg">Wszyscy juลผ wylosowali!</p>
ยยยยยยยยยยยยยยยยยยยย<p className="text-green-800 text-sm">Czas na zakupy!</p>
ยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยย)}
ยยยยยย</GlamourWrapper>
ยยยย);
ยย}

ยย// 3. USTAW PIN / SPRAWDลน PIN
ยยif (view === 'pin-setup' || view === 'pin-check') {
ยยยยconst isSetup = view === 'pin-setup';
ยยยยreturn (
ยยยยยย<GlamourWrapper>
ยยยยยยยยยยย<div className="text-center mb-8 relative z-20">
ยยยยยยยยยยยยย<div className="bg-gradient-to-br from-yellow-100 to-yellow-200 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-yellow-400/50 shadow-inner">
ยยยยยยยยยยยยยยย<Lock className="w-10 h-10 text-yellow-700" />
ยยยยยยยยยยยยย</div>
ยยยยยยยยยยยยย<h2 className="text-3xl font-bold text-red-900 mb-2" style={{ fontFamily: 'Georgia, serif' }}>Czeลฤ {selectedPerson}! ๐</h2>
ยยยยยยยยยยยยย
ยยยยยยยยยยยยย{isSetup ? (
ยยยยยยยยยยยยยยยยย<div className="bg-red-50 border-l-4 border-red-500 text-red-800 p-4 rounded-r-lg text-sm text-left mx-auto max-w-xs">
ยยยยยยยยยยยยยยยยยยยย<p className="font-bold mb-1 flex items-center gap-1"><Lock className="w-4 h-4"/> Bezpieczeลstwo:</p>
ยยยยยยยยยยยยยยยยยยยย<p>Ustaw 4-cyfrowy PIN. <b>Nie uลผywaj prostych kodรณw</b> (np. 1234, 0000, 1111), bo system je odrzuci!</p>
ยยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยยย) : (
ยยยยยยยยยยยยยยยยย<p className="text-sm text-red-800/80 mt-4 font-medium">
ยยยยยยยยยยยยยยยยยยยPodaj swรณj tajny PIN, aby zobaczyฤ kogo wylosowaลeล.
ยยยยยยยยยยยยยยยยย</p>
ยยยยยยยยยยยยย)}
ยยยยยยยยยยย</div>

ยยยยยยยยยยย<div className="relative z-20 max-w-xs mx-auto">
ยยยยยยยยยยยย<input 
ยยยยยยยยยยยยยยยยtype="tel" 
ยยยยยยยยยยยยยยยยmaxLength={4}
ยยยยยยยยยยยยยยยยvalue={pinInput}
ยยยยยยยยยยยยยยยยonChange={(e) => setPinInput(e.target.value)}
ยยยยยยยยยยยยยยยยclassName="w-full bg-white text-center text-4xl tracking-[0.5em] p-5 rounded-2xl border-4 border-yellow-400/50 focus:border-red-500 focus:bg-yellow-50 focus:outline-none mb-6 font-mono text-red-900 shadow-inner transition-all"
ยยยยยยยยยยยยยยยยplaceholder="โขโขโขโข"
ยยยยยยยยยยยย/>
ยยยยยยยยยยยย
ยยยยยยยยยยยย{error && (
ยยยยยยยยยยยยยยยย<div className="bg-red-100 text-red-700 px-4 py-3 rounded-lg text-sm font-bold mb-6 animate-in fade-in border border-red-200 flex items-center justify-center gap-2">
ยยยยยยยยยยยยยยยยยยยยโ๏ธ {error}
ยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยย)}

ยยยยยยยยยยยย<button 
ยยยยยยยยยยยยยยยยonClick={isSetup ? handleSetupPin : handleCheckPin}
ยยยยยยยยยยยยยยยยdisabled={isLoading}
ยยยยยยยยยยยยยยยยclassName="w-full bg-gradient-to-r from-red-700 to-red-900 hover:from-red-800 hover:to-red-950 text-yellow-100 font-bold py-4 rounded-xl shadow-lg mb-4 border border-yellow-500/50 transition-transform active:scale-95"
ยยยยยยยยยยยย>
ยยยยยยยยยยยยยยยย{isLoading ? 'Sprawdzam...' : (isSetup ? '๐ Zapisz PIN i Losuj' : '๐ Odkryj Los')}
ยยยยยยยยยยยย</button>
ยยยยยยยยยยยย
ยยยยยยยยยยยย<button 
ยยยยยยยยยยยยยยยยonClick={() => { setView('lobby'); setPinInput(''); setError(''); }}
ยยยยยยยยยยยยยยยยclassName="w-full text-red-800/70 hover:text-red-900 text-sm font-semibold underline"
ยยยยยยยยยยยย>
ยยยยยยยยยยยยยยยยAnuluj
ยยยยยยยยยยยย</button>
ยยยยยยยยยยย</div>
ยยยยยย</GlamourWrapper>
ยยยย);
ยย}

ยย// 4. WYNIK (REVEAL)
ยยif (view === 'reveal' && selectedPerson && roomData) {
ยยยยconst data = roomData.assignments[selectedPerson];
ยยยยreturn (
ยยยยยย<div className="min-h-screen bg-glamour-pattern flex items-center justify-center p-4 font-sans relative overflow-hidden">
ยยยยยยยย<div className="absolute inset-0 bg-gradient-to-b from-transparent via-black/20 to-black/50 pointer-events-none"></div>
ยยยยยยยย<Snowfall />
ยยยยยยยย
ยยยยยยยย<div className="w-full max-w-md rounded-[2.5rem] shadow-[0_0_50px_rgba(220,20,60,0.4)] overflow-hidden relative z-10 animate-in slide-in-from-bottom duration-500 border-4 border-yellow-500/80">
ยยยยยยยยยยยย{/* Karta Wyniku */}
ยยยยยยยยยยยย<div className="bg-gradient-to-b from-red-700 via-red-800 to-red-950 p-10 text-white text-center relative overflow-hidden">
ยยยยยยยยยยยยยยยย<div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/christmas-candy.png')]"></div>
ยยยยยยยยยยยยยยยย<Snowflake className="absolute top-6 right-6 text-yellow-300/40 w-12 h-12 animate-spin-slow" />
ยยยยยยยยยยยยยยยย<Sparkles className="absolute bottom-6 left-6 text-yellow-300/40 w-10 h-10 animate-pulse" />
ยยยยยยยยยยยยยยยย
ยยยยยยยยยยยยยยยย<div className="relative z-10">
ยยยยยยยยยยยยยยยยยยยย<h2 className="text-yellow-200 text-sm uppercase tracking-widest font-bold mb-4">๐ Twรณj cel na te ลwiฤta ๐</h2>
ยยยยยยยยยยยยยยยยยยยย<div className="mb-8">
ยยยยยยยยยยยยยยยยยยยยยยยย<span className="text-6xl font-extrabold drop-shadow-[0_4px_4px_rgba(0,0,0,0.3)] block mb-6 text-white" style={{ fontFamily: 'Georgia, serif' }}>
ยยยยยยยยยยยยยยยยยยยยยยยยยยยย{data.receiver}
ยยยยยยยยยยยยยยยยยยยยยยยย</span>
ยยยยยยยยยยยยยยยยยยยยยยยย<div className="inline-block bg-black/30 border-2 border-yellow-500/50 px-6 py-3 rounded-full">
ยยยยยยยยยยยยยยยยยยยยยยยยยยยย<span className="text-yellow-400 font-bold text-sm uppercase mr-2">Budลผet:</span>
ยยยยยยยยยยยยยยยยยยยยยยยยยยยย<span className="text-yellow-100 font-mono text-3xl font-bold drop-shadow-sm">{data.amount} PLN</span>
ยยยยยยยยยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยยยยยย</div>
ยยยยยยยยยยยย</div>
ยยยยยยยยยยยย
ยยยยยยยยยยยย<div className="p-8 bg-cream-100 text-center relative">
ยยยยยยยยยยยยยยยย<p className="text-red-900/70 text-sm mb-6 font-medium italic border-b border-red-200 pb-4">
ยยยยยยยยยยยยยยยยยยยย"Psst! To nasza sลodka tajemnica. Aby zobaczyฤ to ponownie, bฤdziesz musiaล podaฤ swรณj PIN." ๐คซ
ยยยยยยยยยยยยยยยย</p>
ยยยยยยยยยยยยยยยย<button 
ยยยยยยยยยยยยยยยยยยยยonClick={handleMarkAsRevealed}
ยยยยยยยยยยยยยยยยยยยยclassName="w-full bg-gradient-to-r from-gray-900 to-black hover:from-gray-800 hover:to-gray-900 text-yellow-100 font-bold py-5 rounded-2xl shadow-xl flex items-center justify-center gap-3 transition-transform active:scale-95 border border-yellow-500/30"
ยยยยยยยยยยยยยยยย>
ยยยยยยยยยยยยยยยยยยยย<EyeOff className="w-6 h-6 text-yellow-400" />
ยยยยยยยยยยยยยยยยยยยย<span className="text-lg">Ukryj i wrรณฤ do salonu</span>
ยยยยยยยยยยยยยยยย</button>
ยยยยยยยยยยยย</div>
ยยยยยยยย</div>
ยยยยยย</div>
ยยยย);
ยย}

ยยreturn null;
}
